<!-- List Header -->
<div class="container mb-5">
  <div class="card mb-4 shadow-sm position-relative">

    <% if @list.image.present? %>
      <!-- Header MIT Bild -->
      <%= cl_image_tag @list.image.key, class: "card-img-top", style: "height: 300px; object-fit: cover;", crop: :fill %>

      <h1 class="position-absolute top-50 start-50 translate-middle
                 text-white text-center bg-dark bg-opacity-50 p-3 rounded
                 fw-bold display-3 w-100">
        <%= @list.name %>
      </h1>

    <% else %>
      <!-- Header OHNE Bild -->
      <div class="d-flex align-items-center justify-content-center"
           style="height: 200px; background-color: #e9ecef;">
        <h1 class="text-dark fw-bold display-4 text-center mb-0">
          <%= @list.name %>
        </h1>
      </div>
    <% end %>

  </div>
</div>

<!-- Movies als Cards -->
  <div class="container">
    <div class="row g-4 justify-content-center">
      <% @list.movies.each do |movie| %>
        <% bookmark = @list.bookmarks.find_by(movie: movie) %>

        <div class="col-12 col-md-6 col-lg-4 d-flex">
          <div class="card shadow-sm w-100 d-flex flex-column">

            <!-- Poster -->
            <% if movie.poster_url.present? %>
              <img src="<%= movie.poster_url %>"
                  class="card-img-top"
                  alt="<%= movie.title %>"
                  style="height: 300px; object-fit: cover;">
            <% end %>

            <div class="card-body d-flex flex-column">

              <!-- Titel + Rating -->
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="fw-bold mb-0"><%= movie.title %></h5>

                <!-- Zentrierter Stern mit Zahl -->
                <div class="d-flex justify-content-center align-items-center position-relative"
                    style="width: 2.2rem; height: 2.2rem;">
                  <i class="fas fa-star text-warning fs-2"></i>
                  <span class="position-absolute fw-bold"
                        style="font-size: 0.9rem; color: black;">
                    <%= '%.1f' % movie.rating %>
                  </span>
                </div>
              </div>

              <!-- Movie Overview -->
              <% if movie.overview.present? %>
                <p class="text-muted mb-3" style="font-size: 0.9rem; max-height: 85px; overflow: hidden;">
                  <%= movie.overview %>
                </p>
              <% end %>

              <!-- Kommentar + Delete Button in einer Linie -->
              <div class="mt-auto d-flex justify-content-between align-items-start">

                <!-- Kommentar -->
                <% if bookmark&.comment.present? %>
                  <p class="mb-0 text-dark d-flex"
                    style="font-size: 1rem; max-width: 85%; position: relative; padding-left: 1.4rem;">
                    <span class="position-absolute"
                          style="left: 0; top: -4px; font-size: 2rem; color:#666;">
                      â€œ
                    </span>
                    <%= bookmark.comment %>
                  </p>
                <% else %>
                  <div></div>
                <% end %>

                <!-- Delete Button -->
                <%= link_to bookmark_path(bookmark),
                    data: { turbo_method: :delete, turbo_confirm: "Are you sure?" },
                    class: "btn btn-outline-secondary btn-sm ms-2" do %>
                  <i class="fas fa-trash-alt"></i>
                <% end %>
              </div>

            </div>
          </div>
        </div>

      <% end %>
    </div>
  </div>


  <!-- Add a movie Button -->
  <div class="fixed-bottom text-center mb-3">
    <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addMovieModal">
      <i class="fas fa-plus me-2"></i> Add a movie
    </button>
  </div>


  <!-- Add Movie Modal -->
  <div class="modal fade" id="addMovieModal" tabindex="-1" aria-labelledby="addMovieModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="addMovieModalLabel">Add a New Movie to This List</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">

          <%= simple_form_for [@list, @bookmark], html: { class: "needs-validation" } do |f| %>

            <div class="mb-3">
              <%= f.association :movie,
                  label: "Select Movie",
                  input_html: { class: "form-select" } %>
            </div>

            <div class="mb-3">
              <%= f.input :comment,
                  label: "Your Comment",
                  input_html: { class: "form-control", placeholder: "Optional comment..." } %>
            </div>

            <div class="d-grid">
              <%= f.button :submit, class: "btn btn-primary btn-lg" do %>
                <i class="fas fa-plus me-2"></i> Add Movie
              <% end %>
            </div>

          <% end %>

        </div>

      </div>
    </div>
  </div>

  <br>
  <hr>
  <br>

<!-- Reviews + Add Review -->
<div class="container my-4">
  <div class="row g-4">

    <!-- Review List -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="mb-4">Reviews</h3>

          <% if @list.reviews.any? %>
            <% @list.reviews.each do |review| %>
              <div class="mb-3 p-3 border rounded">

                <!-- Sterne -->
                <div class="mb-2">
                  <% 1.upto(5) do |i| %>
                    <% if i <= review.rating %>
                      <i class="fas fa-star text-warning"></i>
                    <% else %>
                      <i class="fas fa-star text-secondary"></i>
                    <% end %>
                  <% end %>
                </div>

                <!-- Kommentar -->
                <% if review.comment.present? %>
                  <p class="mb-0"><%= review.comment %></p>
                <% else %>
                  <p class="mb-0 text-muted fst-italic">No comment</p>
                <% end %>

              </div>
            <% end %>
          <% else %>
            <p class="text-muted fst-italic">No reviews yet.</p>
          <% end %>

        </div>
      </div>
    </div>

    <!-- Add Review Form -->
    <div class="col-12 col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">

          <h3 class="mb-4">What do you think of this list?</h3>

          <%= simple_form_for [@list, @review], data: {turbo: false} do |f| %>

            <!-- Star Rating -->
            <div class="mb-3">
              <label class="form-label">Rating</label>
              <div class="d-flex">

                <% (1..5).each do |star| %>
                  <label class="me-1" style="cursor: pointer;">
                    <%= f.radio_button :rating, star, class: "d-none" %>
                    <i class="fas fa-star text-secondary fs-4"
                       data-star="<%= star %>"></i>
                  </label>
                <% end %>

              </div>
            </div>

            <!-- Comment -->
            <div class="mb-3 flex-grow-1">
              <%= f.input :comment,
                  label: "Your comment",
                  input_html: { class: "form-control", rows: 4 },
                  wrapper: false %>
            </div>

            <!-- Submit -->
            <div class="d-grid mt-auto">
              <%= button_tag type: "submit", class: "btn btn-primary btn-lg" do %>
                <i class="fas fa-paper-plane me-2"></i>
                Leave your opinion!
              <% end %>
            </div>

          <% end %>

        </div>
      </div>
    </div>

  </div>
</div>




</div>
